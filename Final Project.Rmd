---
title: "Optimal song properties for popularity"
author: "Group 3"
date: "December 4th, 2024"
output: pdf_document
---

List your group members, including their student numbers, here:

-   Justin Lee (169085217)
-   Raiyan Junaid (169099497)
-   Dylan Plut ()
-   Seamus Chai ()

# Libraries

```{r}
library(tidyverse)
library(tidymodels)
library(devtools)
library(data.table)
```

```{r}
folder_path <- "Raw Data Files"
csv_files <- list.files(path = folder_path, pattern = "\\.csv$", full.names = TRUE)
data_list <- lapply(csv_files, fread)
data_list
```

# Tidying Data

```{r}
# Joining the datasets
read_and_convert <- function(file) {
  df <- read_csv(file, col_types = cols(.default = "c"))
  df |> mutate(across(everything(), as.character))
}

all_data <- map(csv_files, read_and_convert)
combined_data <- bind_rows(all_data)

numeric_cols <- c("Duration (ms)", "Popularity", "Danceability", "Energy", "Key", "Loudness", 
                  "Mode", "Speechiness", "Acousticness", "Instrumentalness", "Liveness", 
                  "Valence", "Tempo", "Time Signature")

combined_data <- combined_data |>
  mutate(across(all_of(numeric_cols), as.numeric),
         `Release Date` = as.POSIXct(`Release Date`, format = "%Y-%m-%d")) |>
  select(-`Added By`, -`Added At`)


# Creating the decades column
combined_data <- combined_data |>
  mutate(Decade = case_when(
    year(`Release Date`) >= 2020 ~ "2020+",
    year(`Release Date`) >= 2010 | `Release Date` < 2020 ~ "2010-2020",
    year(`Release Date`) < 2010 ~ "1998-2010"
  ),
# Fixing the duration column to not be in ms but instead in seconds
  `Duration (sec)` = `Duration (ms)` / 1000)
combined_data
```

# Visualizations

### Artist Count vs Popularity

```{r}
split_artists <- strsplit(combined_data$`Artist Name(s)`, ",")
artist_counts <- sapply(split_artists, length)

combined_data$artist_count <- artist_counts

combined_data |>
  filter(artist_count > 1)
```
